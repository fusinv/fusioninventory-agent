#!/usr/bin/make	-f

%:
	dh $@ --with systemd

override_dh_auto_configure:
	rm -f MANIFEST
	perl Makefile.PL -- PREFIX=/usr SYSCONFDIR=/etc/fusioninventory LOCALSTATEDIR=/var/lib/fusioninventory-agent
	make manifest

override_dh_auto_build:
	dh_auto_build
	perl debian/refresh-install-files

override_dh_auto_clean:
	[ ! -d var ] || rm -r var
	[ ! -d blib ] || rm -r blib
	[ ! -f Makefile ] || rm Makefile
	[ ! -f MYMETA.yml ] || rm MYMETA.yml
	[ ! -f MYMETA.json ] || rm MYMETA.json
	rm -f \
		t/agent/http/client/connection.t \
		t/agent/http/client/fusion/response.t \
		t/agent/http/client/ocs/response.t \
		t/agent/http/client/ssl.t \
		t/tasks/deploy/p2p.t \
		t/tasks/wakeonlan.t \
		t/tasks/inventory/virtualization/hyperv.t
	rm -f \
		t/agent/tools/aix.t t/agent/tools/bsd.t t/agent/tools/hpux.t \
		t/agent/tools/macos.t t/agent/tools/solaris.t t/agent/tools/win32.t
	rm -rf t/tasks/inventory/aix t/tasks/inventory/bsd t/tasks/inventory/hpux \
		t/tasks/inventory/macos t/tasks/inventory/solaris t/tasks/inventory/windows \
		resources/aix resources/bsd resources/hpux \
		resources/macos resources/solaris resources/win32
	dh_clean
